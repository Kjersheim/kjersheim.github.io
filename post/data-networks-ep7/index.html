<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='http://localhost:1313/js/theme-mode.js'></script>
    <link rel="stylesheet" href='http://localhost:1313/css/frameworks.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/github.min.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/github-style.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/light.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/dark.css' />
    <link rel="stylesheet" href='http://localhost:1313/css/syntax.css' />
    <title>Data Networks Episode 7: Loop detection, part 1. Ethernet, Spanning Tree Protocol - Kjersheim - Projects &amp; Docs</title>
    
    <link rel="icon" type="image/x-icon" href='http://localhost:1313/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    

    
    <meta name="description"
  content="Exploring the first steps of network analysis using Lubuntu virtual machines, ping, traceroute, and pathping." />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://localhost:1313/post/data-networks-ep7/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Data Networks Episode 7: Loop detection, part 1. Ethernet, Spanning Tree Protocol - Kjersheim - Projects &amp; Docs" />
<meta name="twitter:description"
  content="Exploring the first steps of network analysis using Lubuntu virtual machines, ping, traceroute, and pathping." />
<meta name="twitter:site" content="http://localhost:1313/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="http://localhost:1313/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Data Networks Episode 7: Loop detection, part 1. Ethernet, Spanning Tree Protocol - Kjersheim - Projects &amp; Docs">
<meta property="og:description"
  content="Exploring the first steps of network analysis using Lubuntu virtual machines, ping, traceroute, and pathping." />
<meta property="og:url" content="http://localhost:1313/post/data-networks-ep7/" />
<meta property="og:site_name" content="Data Networks Episode 7: Loop detection, part 1. Ethernet, Spanning Tree Protocol" />
<meta property="og:image"
  content="http://localhost:1313/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2023-02-23 00:00:00 &#43;0000 UTC" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="http://localhost:1313/">
        <img class="octicon" height="32" width="32" src="/images/avatar.svg">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:http://localhost:1313/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="http://localhost:1313/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/avatar.svg">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="http://localhost:1313/">
                  <img class=" avatar-user"
                    src="/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="http://localhost:1313/">Andreas</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="http://localhost:1313/post/data-networks-ep7/">Data Networks Episode 7: Loop detection, part 1. Ethernet, Spanning Tree Protocol</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Thu, 23 Feb 2023 00:00:00 &#43;0000"
                    class="no-wrap">
                    Thu, 23 Feb 2023 00:00:00 &#43;0000</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      3191 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="e07">E07</h1>
<p>The functionality of a switch is to learn about their surroundings. When the switch receive an ethernet frame, and build up their forwarding table - &ldquo;MAC-address table, -show fdb&rdquo;, they start to forward traffic in an ethernet network.
If a switch do not have a destination MAC-address, an unknown address that is not in the FDB, the switch will spam out unknown MAC-addresses. &ldquo;Unknown dstMAC frames&rdquo; out of all ports.</p>
<p>Within a RING topology, this is bad if there is no loop-detection, and it will form an infinite repetition loop. <strong>Ethernet frames do not have TTL-field.</strong></p>
<pre tabindex="0"><code>Following the thread on this one to elaborate.

Historically it seems that a TTL-field on the ethernet frames were not, thought of or needed when they were introduced due to the limited complexities within networks, before switches and such were invented. 
Why not add it in later on? From what I have gained, a TTL-field would in the end just stop the one frame, and not fix an underlying issue of looping frames. 

From what I understand, if a host is caught in a loop, it is unaccessible from other hosts on the network. A &#34;broadcast storm&#34; can occur when there are so many frames in a loop that all avaliable bandwidth
is consumed. A TTL value would still have the frame run a loop, just not indefinitely, but long enough to cause problems? Can it be compared to a denial of service attack? 
In such a broadcast storm the forwarding tables are constantly updated with MAC-addresses, and even though the packet finally arrives at the correct destination it seems the tables are constantly faulty updated so the answer wont
be sent to the right recipient.

In the end, would not a TTL-field atleast help? But perhabs its still too little help to fix the issue. There will always be loops in a network which have been designed to avoid a single point of failure, 
and have multiple &#34;roads&#34;. when this redundancy is introduced, loops and duplicate frames occur.  Despite the questions of TTL, this is the reason why The Spanning Tree Protocol was created, and from what I can see before entering
the materials is that it fixes the issues and TTL is out of the question. 
</code></pre><h2 id="plan">Plan</h2>
<ul>
<li>
<p><input disabled="" type="checkbox"> Update and review current topology</p>
<ul>
<li><input disabled="" type="checkbox"> Add Network_Switch_C to the topology, RING-topology</li>
<li><input disabled="" type="checkbox"> Move Lubuntu2 machine behind Network_Switch_C</li>
<li><input disabled="" type="checkbox"> Update adapters VirtualBox</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> Configuration, update VLAN</p>
<ul>
<li><input disabled="" type="checkbox"> Switch A</li>
<li><input disabled="" type="checkbox"> Switch B</li>
<li><input disabled="" type="checkbox"> Switch C</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> Loop</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Spanning Tree Protocol</p>
<ul>
<li><input disabled="" type="checkbox"> Update topology schematic</li>
<li><input disabled="" type="checkbox"> Enable on all 3 Switches</li>
<li><input disabled="" type="checkbox"> Investigate port states</li>
<li><input disabled="" type="checkbox"> Testing</li>
<li><input disabled="" type="checkbox"> Last phase testing, measure changes in topology</li>
</ul>
</li>
</ul>
<h1 id="update-and-review-current-topology">Update and review current topology</h1>
<p>First steps is to clone a switch and add it to the schematic, set as a RING with the other switches. Then moving Lubuntu2 behind the new switch.</p>
<h2 id="draft-of-physical-topology-changes">Draft of physical topology changes</h2>
<p><img src="/images/network-doc/E07/E07NetworkCharts-Physical_Topology_draft3.png" alt=""></p>
<h2 id="updating-adapters">Updating adapters</h2>
<p>After drafting the physical changes, I start checking the adapters in VirtualBox, to make sure the &ldquo;cables and interfaces&rdquo; are correct.</p>
<p><img src="/images/network-doc/E07/AdaptersSwitchA.png" alt="">
<img src="/images/network-doc/E07/AdaptersSwitchB.png" alt=""></p>
<p><img src="/images/network-doc/E07/AdaptersSwitchC.png" alt=""></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Update and review current topology
<ul>
<li><input checked="" disabled="" type="checkbox"> Add Network_Switch_C to the topology, RING-topology</li>
<li><input checked="" disabled="" type="checkbox"> Move Lubuntu2 machine behind Network_Switch_C</li>
<li><input checked="" disabled="" type="checkbox"> Update adapters VirtualBox</li>
</ul>
</li>
</ul>
<h2 id="updating-vlan--tagging-ports">Updating VLAN &amp; tagging ports</h2>
<p><img src="/images/network-doc/E07/SwitchAtagging1.png" alt=""></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Switch A</li>
</ul>
<p><img src="/images/network-doc/E07/SwitchBtagging.png" alt=""></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Switch B</li>
</ul>
<p><img src="/images/network-doc/E07/SwitchCtagging.png" alt=""></p>
<p>In addition to this, adding a new ip-address and a gateway to Switch C.</p>
<p><img src="/images/network-doc/E07/SwitchCIpAndGateway.png" alt=""></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Switch C</li>
<li><input checked="" disabled="" type="checkbox"> Configuration, update VLAN</li>
</ul>
<h1 id="connectivity-tests-pre-stp">Connectivity tests pre-STP</h1>
<h2 id="switch-a-and-b-online-switch-c-offline">Switch A and B online, Switch C offline</h2>
<p>Powering up all 3 Lubuntus, both routers and the abovementioned Switch A and B.</p>
<p>Initially I ping Lubuntu3 from Lubuntu1:</p>
<p><img src="/images/network-doc/E07/PingL1L3.png" alt=""></p>
<p>Then I ping various devices from Lubuntu3:</p>
<p><img src="/images/network-doc/E07/L3Ping_1.png" alt=""></p>
<p>Seeing that Network_Switch_C is offline, any response from Lubuntu2 is not going to happend, as Lubuntu2 is only connected to Network_Switch_C.</p>
<h2 id="switch-b-and-c-online-switch-a-offline">Switch B and C online, Switch A offline</h2>
<p>Shutting down Switch A, powering up Switch C.</p>
<p>Lubuntu3 to Lubuntu2:</p>
<p><img src="/images/network-doc/E07/PingL3L2.png" alt=""></p>
<p>Lubuntu 2 to different parts of the topology:</p>
<p><img src="/images/network-doc/E07/L2Ping_1_1.png" alt=""></p>
<h1 id="creating-a-loop">Creating a loop</h1>
<p>I start of by closing down all switches, keeping routers and lubuntus online. I then proceed in making the lubuntus ping eachother, each Lubuntu marked with a red square around its number.</p>
<p><img src="/images/network-doc/E07/RunningLubuntusAndRouters.png" alt=""></p>
<p>Having all 3 Lubuntus pinging eachother, but no switches being online - none will reach. In the next figure I start Network_Switch_A.</p>
<p>I proceed starting Network_Switch_A and Network_Switch_B, monitoring the gpu as well as checking port status on the switches once they are online.</p>
<p>After Switch A is up, there is still no connectivity as the other lubuntus need atleast one of the other switches to be online aswell.</p>
<p>Booting up Switch B, and connection between Lubuntu3 and Lubuntu1 is visible in the picture below. Lubuntu2 is still behind Switch C.
For some reason Lubuntu1 is not reaching Lubuntu3, but it does work the other way around. Cancelling the ping and restarting it fixes the problem.</p>
<p><img src="/images/network-doc/E07/StartingSwitchB.png" alt=""></p>
<h3 id="starting-network_switch_c">Starting Network_Switch_C</h3>
<p>Starting up the third Switch, completing the connection of the RING, visualized in the following <strong>GIF</strong>.
Immidiately I see that the processor is hitting the roof. Lubuntu2 Also suddenly get response from Lubuntu3, but it is very slow to update on the screen.
In addition Lubuntu3 sees a hop in response &ldquo;latency&rdquo;.</p>
<p><img src="/images/network-doc/E07/StartingSwitchC.gif" alt=""></p>
<h3 id="shutting-down-network_switch_c">Shutting down Network_Switch_C</h3>
<p>And finally when shutting down Switch C, the processes drop immidiately, as shown in the <strong>GIF</strong> below.</p>
<p><img src="/images/network-doc/E07/ShuttingDownSwitchC.gif" alt=""></p>
<h1 id="spanning-tree-protocol">Spanning Tree Protocol</h1>
<h2 id="configuring-switches">Configuring switches</h2>
<p>Staring with Network_Switch_B as root, then A as backup root and lastly also adding STP to all VLANS and enabling it on Switch C. I do notice later on that &ldquo;backup&rdquo; is not enabled within the configurations
of the STP on either Switch. However the priority ID is set accordingly, so I suspect maybe there would be some reactions depending on which ports I temporarily disable at the end of this exercise.</p>
<p><strong>Switch B:</strong></p>
<p><img src="/images/network-doc/E07/STPswitchB.png" alt=""></p>
<p><strong>Switch A:</strong></p>
<p><img src="/images/network-doc/E07/STPswitchA.png" alt=""></p>
<p><strong>Switch C:</strong></p>
<p><img src="/images/network-doc/E07/STPswitchC.png" alt=""></p>
<p>At the end of this, I start up Switch A and B, so all 3 are online.</p>
<p><img src="/images/network-doc/E07/BootingUpRemainingSwitches.png" alt=""></p>
<p>As can be seen in the <strong>GIF</strong> below, the Lubuntus are now able to communicate and it seems the looping is under control!</p>
<p><img src="/images/network-doc/E07/AllSwitchesSTP.gif" alt=""></p>
<ul>
<li><input disabled="" type="checkbox"> Spanning Tree Protocol
<ul>
<li><input disabled="" type="checkbox"> Update topology schematic</li>
<li><input checked="" disabled="" type="checkbox"> Enable on all 3 Switches</li>
<li><input disabled="" type="checkbox"> Investigate port states</li>
<li><input checked="" disabled="" type="checkbox"> Testing</li>
<li><input disabled="" type="checkbox"> Last phase testing, measure changes in topology</li>
</ul>
</li>
</ul>
<p><strong>Network_Switch_B</strong></p>
<pre tabindex="0"><code>------------------------
SwitchB.1 # show stpd s0 
------------------------
Stpd: s0                Stp: ENABLED            Number of Ports: 3
Rapid Root Failover: Disabled
Operational Mode: MSTP                  Default Binding Mode: 802.1D
MSTI Instance:  CIST
802.1Q Tag: (none)
Ports: 1,2,3
Participating Vlans: network_devices,secretbasement,workstations
Auto-bind Vlans: Default
Bridge Priority            : 4096               Bridge Priority Mode: 802.1t
Operational Bridge Priority: 4096
BridgeID                   : 10:00:08:00:27:02:cc:fa
Designated root            : 10:00:08:00:27:02:cc:fa
CIST Root                  : 10:00:08:00:27:02:cc:fa
CIST Regional Root         : 10:00:08:00:27:02:cc:fa
External RootPathCost      : 0  Internal RootPathCost: 0 
Root Port   : ----      
MaxAge      : 20s       HelloTime     : 2s      ForwardDelay     : 15s
CfgBrMaxAge : 20s       CfgBrHelloTime: 2s      CfgBrForwardDelay: 15s
RemainHopCount: 20      CfgMaxHopCount: 20
Topology Change Time           : 35s            Hold time        : 1s
Topology Change Detected       : FALSE          Topology Change  : FALSE
Number of Topology Changes     : 2
Time Since Last Topology Change: 725s
Topology Change initiated locally on Port 2
Topology Change last received on Port 1 from 08:00:27:8b:dd:b1
Backup Root               : Off         Backup Root Activated  : FALSE
Loop Protect Event Window : 180s        Loop Protect Threshold : 3
New Root Trap             : On          Topology Change Trap   : Off
Tx Hold Count             : 6
SwitchB.2 # 


------------------------------
SwitchB.2 # show stpd s0 ports 
------------------------------

Port     Mode   State      Cost  Flags     Priority Port ID Designated Bridge
1      802.1D FORWARDING 200000 eDap-m--I- 128      8001    10:00:08:00:27:02:cc:fa
2      802.1D FORWARDING 200000 eDap-m--I- 128      8002    10:00:08:00:27:02:cc:fa
3      802.1D FORWARDING 200000 eDappw--B- 128      8003    10:00:08:00:27:02:cc:fa

Total Ports: 3

 ------------------------- Flags: ----------------------------
1:                e=Enable, d=Disable
2: (Port role)    R=Root, D=Designated, A=Alternate, B=Backup, M=Master
3: (Config type)  b=broadcast, p=point-to-point, e=edge, a=auto
4: (Oper. type)   b=broadcast, p=point-to-point, e=edge
5:                p=proposing, a=agree
6: (partner mode) d = 802.1d, w = 802.1w, m = mstp
7:                i = edgeport inconsistency
8:                S = edgeport safe guard active
                  s = edgeport safe guard configured but inactive
8:                G = edgeport safe guard bpdu restrict active in 802.1w and mstp
                  g = edgeport safe guard bpdu restrict active in 802.1d
9:                B = Boundary, I = Internal
10:               r = restricted role, t = active role
SwitchB.3 # 
</code></pre><p><strong>Network_Switch_A</strong></p>
<pre tabindex="0"><code>Lubuntu-1: ssh admin@10.8.83.1
admin@10.8.83.1&#39;s password: 
ExtremeXOS
Copyright (C) 1996-2020 Extreme Networks. All rights reserved.
...
==============================================================================


Press the &lt;tab&gt; or &#39;?&#39; key at any time for completions.
Remember to save your configuration changes.

------------------------
SwitchA.1 # show stpd s0 
------------------------
Stpd: s0                Stp: ENABLED            Number of Ports: 3
Rapid Root Failover: Disabled
Operational Mode: MSTP                  Default Binding Mode: 802.1D
MSTI Instance:  CIST
802.1Q Tag: (none)
Ports: 1,2,3
Participating Vlans: network_devices,secretbasement,workstations
Auto-bind Vlans: Default
Bridge Priority            : 8192               Bridge Priority Mode: 802.1t
Operational Bridge Priority: 8192
BridgeID                   : 20:00:08:00:27:8b:dd:b1
Designated root            : 10:00:08:00:27:02:cc:fa
CIST Root                  : 10:00:08:00:27:02:cc:fa
CIST Regional Root         : 10:00:08:00:27:02:cc:fa
External RootPathCost      : 0  Internal RootPathCost: 200000 
Root Port   : 2         
MaxAge      : 20s       HelloTime     : 2s      ForwardDelay     : 15s
CfgBrMaxAge : 20s       CfgBrHelloTime: 2s      CfgBrForwardDelay: 15s
RemainHopCount: 19      CfgMaxHopCount: 20
Topology Change Time           : 35s            Hold time        : 1s
Topology Change Detected       : FALSE          Topology Change  : FALSE
Number of Topology Changes     : 3
Time Since Last Topology Change: 903s
Topology Change initiated locally on Port 3
Topology Change last received on Port 2 from 08:00:27:02:cc:fa
Backup Root               : Off         Backup Root Activated  : FALSE
Loop Protect Event Window : 180s        Loop Protect Threshold : 3
New Root Trap             : On          Topology Change Trap   : Off
Tx Hold Count             : 6
SwitchA.2 # show stpd s0 ports 
Port     Mode   State      Cost  Flags     Priority Port ID Designated Bridge
1      802.1D FORWARDING 200000 eDappw--B- 128      8001    20:00:08:00:27:8b:dd:b1
2      802.1D FORWARDING 200000 eRapam--I- 128      8002    10:00:08:00:27:02:cc:fa
3      802.1D FORWARDING 200000 eDap-m--I- 128      8003    20:00:08:00:27:8b:dd:b1

Total Ports: 3

 ------------------------- Flags: ----------------------------
1:                e=Enable, d=Disable
2: (Port role)    R=Root, D=Designated, A=Alternate, B=Backup, M=Master
3: (Config type)  b=broadcast, p=point-to-point, e=edge, a=auto
4: (Oper. type)   b=broadcast, p=point-to-point, e=edge
5:                p=proposing, a=agree
6: (partner mode) d = 802.1d, w = 802.1w, m = mstp
7:                i = edgeport inconsistency
8:                S = edgeport safe guard active
                  s = edgeport safe guard configured but inactive
8:                G = edgeport safe guard bpdu restrict active in 802.1w and mstp
                  g = edgeport safe guard bpdu restrict active in 802.1d
9:                B = Boundary, I = Internal
10:               r = restricted role, t = active role
SwitchA.3 # 
</code></pre><p><strong>Network_Switch_C</strong></p>
<pre tabindex="0"><code>------------------------
SwitchC.1 # show stpd s0 
------------------------
Stpd: s0                Stp: ENABLED            Number of Ports: 3
Rapid Root Failover: Disabled
Operational Mode: MSTP                  Default Binding Mode: 802.1D
MSTI Instance:  CIST
802.1Q Tag: (none)
Ports: 1,2,3
Participating Vlans: network_devices,secretbasement,workstations
Auto-bind Vlans: Default
Bridge Priority            : 32768              Bridge Priority Mode: 802.1t
Operational Bridge Priority: 32768
BridgeID                   : 80:00:08:00:27:94:2c:0b
Designated root            : 10:00:08:00:27:02:cc:fa
CIST Root                  : 10:00:08:00:27:02:cc:fa
CIST Regional Root         : 10:00:08:00:27:02:cc:fa
External RootPathCost      : 0  Internal RootPathCost: 200000 
Root Port   : 2         
MaxAge      : 20s       HelloTime     : 2s      ForwardDelay     : 15s
CfgBrMaxAge : 20s       CfgBrHelloTime: 2s      CfgBrForwardDelay: 15s
RemainHopCount: 19      CfgMaxHopCount: 20
Topology Change Time           : 35s            Hold time        : 1s
Topology Change Detected       : FALSE          Topology Change  : FALSE
Number of Topology Changes     : 2
Time Since Last Topology Change: 1029s
Topology Change initiated locally on Port none
Topology Change last received on Port 2 from 08:00:27:02:cc:fa
Backup Root               : Off         Backup Root Activated  : FALSE
Loop Protect Event Window : 180s        Loop Protect Threshold : 3
New Root Trap             : On          Topology Change Trap   : Off
Tx Hold Count             : 6
------------------------
SwitchC.2 # show stpd s0 ports 
------------------------
Port     Mode   State      Cost  Flags     Priority Port ID Designated Bridge
1      802.1D BLOCKING   200000 eAapam--I- 128      8001    20:00:08:00:27:8b:dd:b1
2      802.1D FORWARDING 200000 eRapam--I- 128      8002    10:00:08:00:27:02:cc:fa
3      802.1D FORWARDING 200000 eDap-w--B- 128      8003    80:00:08:00:27:94:2c:0b

Total Ports: 3

 ------------------------- Flags: ----------------------------
1:                e=Enable, d=Disable
2: (Port role)    R=Root, D=Designated, A=Alternate, B=Backup, M=Master
3: (Config type)  b=broadcast, p=point-to-point, e=edge, a=auto
4: (Oper. type)   b=broadcast, p=point-to-point, e=edge
5:                p=proposing, a=agree
6: (partner mode) d = 802.1d, w = 802.1w, m = mstp
7:                i = edgeport inconsistency
8:                S = edgeport safe guard active
                  s = edgeport safe guard configured but inactive
8:                G = edgeport safe guard bpdu restrict active in 802.1w and mstp
                  g = edgeport safe guard bpdu restrict active in 802.1d
9:                B = Boundary, I = Internal
10:               r = restricted role, t = active role
SwitchC.3 # 
</code></pre><h3 id="stp-topology">STP topology</h3>
<p>From the results above, the STP part of my topology should currently be as shown below:</p>
<p><img src="/images/network-doc/E07/STP_topology.png" alt=""></p>
<pre tabindex="0"><code>Is the root switch position ideal? Are the ports forwarding as you would have expected?
</code></pre><p>From the material, the switch with the lowest priority-number (or of 2 with similar priority the one of them with the lowest decimal value MAC-address) would be determined to be the root switch.
When setting up the STP on each switch, I have already decided that Network_Switch_B would have this role, due to the priority count of 4096.
This because I feel this is the top/bottom point where all branches reach out towards the other devices.</p>
<p>This way traffic will go through the root-switch on its way to each part of the system, and would have multiple ways in case of a cable/connection breaking between the other switches.
From trying to understand more, the term Spanning Tree Cost comes up, or path/port cost. I further see I can get this information from the BPDU-frame.</p>
<p>Though from looking and thinking of my physical topology, the cables within the network at this point are of the same speed and lenght, hence I believe the cost would be the same.
However, when having more and more network devices in my topology, the path grows longer. If I have a 10Gbit connection between all devices, from what I understand it would have a path or port-cost of 2.</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">%%{init: {&#39;theme&#39;: &#39;forest&#39;, &#34;flowchart&#34; : { &#34;curve&#34; : &#34;basis&#34; } } }%%
graph TD;
	SwitchB&lt;-- cost 2 --&gt;RouterA
    RouterA&lt;-- cost 2 --&gt;RouterB
    RouterB&lt;-- cost 2 --&gt;Lubuntu3
    SwitchB&lt;-- cost 2--&gt;SwitchA;
    SwitchB&lt;-- cost 2--&gt;SwitchC;
    SwitchA&lt;-- cost 2--&gt;SwitchC;
    SwitchA&lt;-- cost 2--&gt;Lubuntu1;
    SwitchC&lt;-- cost 2--&gt;Lubuntu2;
</code></pre><p>From the chart the distance from object to <strong>SwitchB as root</strong>:</p>
<ul>
<li>Lubuntu1 to SwitchB has a cost of 4 via SwitchA OR 6 via SwitchA then SwitchC</li>
<li>Lubuntu2 to SwitchB has a cost of 4 via SwitchC OR 6 through SwitchC and A</li>
<li>Lubuntu3 to SwitchB has a cost of 6 via RouterB, RouterA then SwitchB</li>
</ul>
<p>If <strong>SwitchC</strong> was root:</p>
<ul>
<li>Lubuntu1 to SwitchC has a cost of 4 via SwitchA OR 6 via SwitchA then SwitchB</li>
<li>Lubuntu2 to SwitchC has a cost of 2 directly to SwitchC</li>
<li>Lubuntu3 to SwitchC has a cost of 8 Via RouterB, RouterA, SwitchB then SwitchC</li>
</ul>
<p>If <strong>SwitchA</strong> was root:</p>
<ul>
<li>Lubuntu1 to SwitchA has a cost of 2 directly to SwitchA</li>
<li>Lubuntu2 to SwitchA has a cost of 4 via SwitchC to SwitchA OR 6 via SwitchC, SwitchB then SwitchA</li>
<li>Lubuntu3 to SwitchA has a cost of 8 via RouterB, RouterA, SwitchB then SwitchA OR 10 via RouterB, RouterA, SwitchB, SwitchC then SwitchA</li>
</ul>
<p>All in all, for all three variations the total path cost would be the same. So my conclusion to that part is that of this current setup - it doesnt matter in terms of path cost.
However for safety and points of failures, the location of which most likely to stay connected to parts of the network seems to be at where Switch B is.</p>
<p>In terms of the alternative route and location of this, between Switch A and C, that does seem logical. The far points of this part of the network - Lubuntu1 and Lubuntu2 - have shorter roads to Switch B. In case of failure on the ideal routes they have an alternative path.</p>
<p>As an <strong>end note</strong> on this section, I believe that the cost does not decide the root-switch(I already explained that previously), nor does traffic change due to the cost it self. But - when the switches sends STP information
to eachother and marks each port RP / DP and such, RP would be the port with the lowest cost towards the root switch. However I think it might be a nice way to set up and
compare the different &ldquo;roads to ro(me)ot&rdquo;.</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Spanning Tree Protocol
<ul>
<li><input checked="" disabled="" type="checkbox"> Create topology for STP view</li>
<li><input checked="" disabled="" type="checkbox"> Enable on all 3 Switches</li>
<li><input checked="" disabled="" type="checkbox"> Investigate port states</li>
<li><input checked="" disabled="" type="checkbox"> Testing</li>
</ul>
</li>
</ul>
<h2 id="last-phase-testing-measure-changes-in-topology">Last phase testing, measure changes in topology</h2>
<p>I set up the VMs so I can see as much as I can in my limited screenspace.</p>
<ul>
<li>Lubuntu1 is pinging Lubuntu2</li>
<li>Lubuntu2 is pinging Lubuntu3</li>
<li>Lubuntu3 is pinging Lubuntu1</li>
</ul>
<h3 id="disabling-port-1">Disabling port 1</h3>
<p>The first <strong>gif</strong> shows me disabling port 1 of the root switch, Network_Switch_B.
Notice the skip of icmp_sequence on Lubuntu1 and Lubuntu3.</p>
<p><img src="/images/network-doc/E07/disableport1.gif" alt=""></p>
<p>I have highlighted the skip of sequences in the picture below. Port 1 on Switch B is the port that goes towards Switch A.</p>
<p><img src="/images/network-doc/E07/Disableport1.png" alt=""></p>
<table>
  <thead>
      <tr>
          <th>Lubuntu1 to 2</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Lubuntu1 gets its path disrupted, as It is bound to prefer travelling from P2 in SwitchA to P1 in SwitchB, but instead needs to take the alternative route from P3 on SwitchA to P3 on SwitchC, and then to Lubuntu2. This is a curious realization, as this is actually the fastest waywith a cost of 6, while through the RP to Root switch it costs 8.</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>Lubuntu2 to 3</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Lubuntu2 however remains stable, as it is pinging Lubuntu3 and is entering port2 on SwitchB, before continuing out Port3 towards the path to Lubuntu3.</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>Lubuntu3 to 1</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Lubuntu3 gets interupted, as its ping is sent thowards SwitchB, and has its main route through port 1. However with that port being disabled, the ping continues to switch C, before going up to Switch A and then out to Lubuntu1.</td>
      </tr>
  </tbody>
</table>
<h4 id="schematic-for-this-scenario">Schematic for this scenario</h4>
<p><img src="/images/network-doc/E07/Disableport1Schematic.png" alt=""></p>
<h3 id="disabling-port-2">Disabling port 2</h3>
<p><img src="/images/network-doc/E07/disableport2.gif" alt=""></p>
<p>I have highlighted the skip of sequences in the picture below. Port 2 on Switch B is the port that goes towards Switch C.</p>
<p><img src="/images/network-doc/E07/disableport2.png" alt=""></p>
<table>
  <thead>
      <tr>
          <th>Lubuntu1 to 2</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Skips from 1889-1894. Based on the priority of switches, the ping should go from Lubuntu1, to SwitchA, to SwitchB then to SwitchC and out to Lubuntu2. It skips a short while, of which I am thinking it might be due to the switches re-routing the signal back from SwitchB to Switch A again, since the route from SwitchB to SwitchC is disabled. The signal then goes the alternative route between SwitchA and SwitchC.</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>Lubuntu2 to 3</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Skips from 1895 to 1900. By following priority the ping goes from SwitchC to SwitchB then up the network to Lubuntu3. When the port between SwitchB and C is disabled, it has to go from Switches C, then A, then B before going towards Lubuntu3.</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>Lubuntu3 to 1</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>It is not disrupted on its path as by following the priority it will go from SwitchB, directly to SwitchA and out to Lubuntu1. This since the cost of the route via just B and A is the lowest. The connection between C and A is alternative, and also costs more.</td>
      </tr>
  </tbody>
</table>
<p>To measure the change when enabling the port again, the following skips can be seen when I enable port 2:</p>
<p><img src="/images/network-doc/E07/enablingport2.png" alt=""></p>
<h4 id="schematic-for-this-scenario-1">Schematic for this scenario</h4>
<p><img src="/images/network-doc/E07/Disableport2Schematic.png" alt=""></p>
<h3 id="disabling-port-3">Disabling port 3</h3>
<p>I have highlighted the skip of sequences in the picture below. Port 3 on Switch B is the port that goes towards RouterA.</p>
<p>The result here speak for itself, as we are disabling the connection between SwitchB and RouterA - which again is the gateway for each VLAN to communicate between eachother, and also the route to RouterB and Lubuntu3.</p>
<p><img src="/images/network-doc/E07/disableport3.gif" alt="">{width=75%}</p>
<p><img src="/images/network-doc/E07/enableport3.gif" alt="">{width=75%}</p>
<h4 id="schematic-for-this-scenario-2">Schematic for this scenario</h4>
<p><img src="/images/network-doc/E07/Disableport3Schematic.png" alt=""></p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='http://localhost:1313/js/toc.js'></script>
<link rel="stylesheet" href='http://localhost:1313/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="http://localhost:1313/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="http://localhost:1313/js/github-style.js"></script>







</html>